%% bare_jrnl.tex
%% V1.3
%% 2007/01/11
%% by Michael Shell
%% see http://www.michaelshell.org/
%% for current contact information.
%%
%% This is a skeleton file demonstrating the use of IEEEtran.cls
%% (requires IEEEtran.cls version 1.7 or later) with an IEEE journal paper.
%%
%% Support sites:
%% http://www.michaelshell.org/tex/ieeetran/
%% http://www.ctan.org/tex-archive/macros/latex/contrib/IEEEtran/
%% and
%% http://www.ieee.org/


\documentclass[onecolumn,draftcls]{IEEEtran}

\usepackage{graphicx}
\usepackage{color}                    % For creating coloured text and background
\usepackage{amsmath,amssymb,amsfonts} % Typical maths resource packages
% correct bad hyphenation here
\hyphenation{op-tical net-works semi-conduc-tor}
% TODO environment
\newcommand{\todo}[1]{\textsf{\emph{\textbf{\textcolor{blue}{#1}}}}}

\begin{document}

% can use linebreaks \\ within to get better formatting as desired
\title{Estimation of Intracortical Connectivity in a Dynamical Neural Field Model}

\author{Dean~R.~Freestone,~\IEEEmembership{Graduate Student Member,~IEEE,}
        Parham~Aram,~\IEEEmembership{Graduate Student Member,~IEEE,}
        Michael~Dewar,~\IEEEmembership{Member,~IEEE,}
        Kenneth~Scerri,~\IEEEmembership{Member,~IEEE,}
        Visakan~Kadirkamanathan,~\IEEEmembership{Member,~IEEE,}
        David~B.~Grayden,~\IEEEmembership{Member,~IEEE,}
        Anthony~N.~Burkitt,~\IEEEmembership{Member,~IEEE,}
        and~other~Bosses/Supervisors,~\IEEEmembership{Member,~IEEE.}% <-this % stops a space% <-this % stops a space

\thanks{D. Freestone is with the Department
of Electrical and Electronic Engineering, University of Melbourne, Melbourne,
Vic, 3010 Australia {\tt\small dfreestone@bionicear.org}.}% <-this % stops a space
\thanks{P. Aram is with Sheffield...}
\thanks{M. Dewar is with Edinburgh...}
\thanks{K. Scerri is with Malta...}
\thanks{V. Kadirkamanathan is with Sheffield...}

\thanks{Manuscript received Month Day, Year; revised Month Day, Year.}}


% The paper headers
\markboth{Journal of \"{U}ber C\~{o}\~{o}l Engineering,~Vol.~1, No.~1, Christmas~2009}%
{Shell \MakeLowercase{\textit{et al.}}: Bare Demo of IEEEtran.cls for Journals}

\maketitle

\begin{abstract}
Will save this for last.
\end{abstract}


% Note that keywords are not normally used for peerreview papers.
\begin{IEEEkeywords}
Integro-Difference Equation (IDE), Neural Field Model, Cortical Connectivity.
\end{IEEEkeywords}

\IEEEpeerreviewmaketitle

\section{Introduction}
\IEEEPARstart{T}{he} human brain is arguably the world's most complex system. Approximately 100 billion neurons and 60 trillion synapses operate in concert to process information, resulting in the cognition that determines our behavior. The brain's efficiency, robustness, and adaptability are unparalleled by any man-made device and, despite decades of concerted research, our understanding of its complex dynamics remains modest. This has led researchers to study different scales of dynamics: starting from individual proteins, synapses, and neurons; moving through to neuronal networks and ensembles of neuronal networks. While our understanding of the function of neurons is well developed, the overall behavior of the brain's meso and macro-scale dynamics remains largely a mystery.  Understanding the brain at this level is extremely important since this is the scale where pathologies such as epilepsy, Parkinson's disease and schizophrenia are manifested.

To date, there has been a considerable volume of work in generating physiologically plausible neural field models to fill the void of understanding brain dynamics at the meso/macroscopic scale. Mathematical neural field  models provide insights into the underlying physics and dynamics of electroencephalography (EEG) and magnetoencephalography (MEG) (see~\cite{Deco2008}~\cite{David2003} for recent reviews). These models have demonstrated possible mechanisms for the genesis of neural rhythms (such as the alpha and gamma rhythms) \cite{Liley1999} \cite{RENNIE2000}, epileptic seizure generation \cite{DaSilva2003},~\cite{Suffczynski2004} and~\cite{Wendling2005} and insights into other pathologies~\cite{Moran2008} \cite{Schiff2009} that would be impossible to gain from experimental data alone. Unfortunately, to date the use of these models in the clinic has been limited, since the neural field model are constructed for a general brain dynamics and pathologies almost always have unique underlying patient specific causes. Data from EEG and functional magnetic resonance imaging (fMRI) offers the patient specific link to macro-scale cortical dynamics, making these tools readily applicable to the clinic. However the underlying system properties, or system states, are hidden from EEG and fMRI data, making predictions of the underlying physiology inherently difficult.

For models to be clinically viable they must be patient specific. A possible approach to achieve this would be to use a general neural field model, like the Wilson and Cohen~\cite{Wilson1973} model or a neural mass model like the Jansen and Ritt model~\cite{Jansen1995}, and fit it to a patients EEG data. Fitting the neural models to individuals is a highly non-trivial task, and until very recently this has not been reported in the literature. An estimation frame work for neural field models known as dynamical causal modeling (DCM)~\cite{David2003} \cite{David2006} has recently been proposed for studying evoked potential dynamics. Via a Bayesian inference scheme, DCM estimates the long range connectivity structure between the specific isolated brain regions that best explains a given data set. The interconnected brain regions are modeled by the Jansen and Ritt equations. The approach has proven very useful in understanding specific hierarchical networks of neural information processing. Another recent publication describing a parameter estimation method with a neural field model used an unscented Kalman filter with the Wilson-Cowan neural field equations~\cite{schiff2008kalman}.  This work takes a more system theoretic approach to the neural estimation problem and marks a first step in what has the potential to revolutionize the treatment of many neurological diseases where therapeutic electrical stimulation is viable.

Generating patient specific models allows the application of a range of techniques from control systems theory, where tailored electrical stimulation could be used therapeutically in a closed loop fashion.  Currently available epileptic seizure prediction and control devices (i.e., the vagal nerve stimulator) are implemented in an ``open loop".  That is, the therapeutic electrical stimulation waveforms are adjusted for each patient by trial and error, disregarding the patient's neurodynamics and information about their particular pathologies. Given access to an accurate model, the application of control theory in these circumstances would allow for robust therapeutic stimulations.
The work from Schiff and Sauer~\cite{schiff2008kalman} successfully demonstrated  it is possible to estimate parameters from the WC equations. This motivates the question, what parameters are the most important? How patient specific do the assumed parameters have to be for the model to be useful? In this paper, we address both of these questions and provide a theoretical platform to perform patient-specific grey-box modeling of the human neocortex.

\section{The Importance of Cortical Structure}
Neural field models use statistics of the cortex to relate mean firing rates of pre-synaptic neural populations to post-synaptic mean membrane potentials. Each neural population represents a functional cortical processing unit referred to as a column. The columnar organization of the cortex is not discrete, but is continuous, where pyramidal cells are members of many columns. In general, cortical structure can be modeled in a physiologically plausible manner as being locally homogeneous (in short range intracortical connectivity) and heterogeneous (in long range corticocortical and corticothalamic connectivity)~\cite{Jirsa2009}~\cite{Qubbaj2007}. Locally, each column is thought be connected via symmetric short range local excitation, with surround inhibition~\cite{Braitenberg1998}. For example, this structural organization is most studied in the visual system, where the surrounding inhibition effectively tunes a cortical column to a particular receptive visual field~\cite{Sullivan2006}.

Recent studies using neural field models have demonstrated the theoretical implications of specific connectivity structure of the cortical columns in neural field models, where the connectivity kernel governs the bifurcation points of the system~\cite{Hutt2005} and types of oscillations that can be generated~\cite{Schmidt2009}. This implies that if we could estimate the connectivity structure for an individual, then we could capture the essential patient specific neurodynamics that lead to various oscillatory states. Estimating functional cortical connectivity via EEG measures is currently a highly active area of research. There is a lot of interest in understanding the hierarchy of brain regions that are involved in specific tasks, motivating the use of techniques like DCM. Other comparable methods are based on auto-regressive (AR) modeling of the EEG, MEG, or fMRI times series. Studies have concentrated on finding functional connectivity patterns using information contained in the AR coefficients using techniques like Granger causality~\cite{Hesse2003}, the direct transfer function~\cite{Kaminski1991}, and partial directed coherence~\cite{Sameshima1999}. Again, like the DCM approach, these methods estimate long range connectivity patterns that does not provide a clear relationship between the continuum field models and data.
%Analysis of the connectivity estimates provided from these approaches has involved graph theoretical techniques (small worldedness).

Until now, estimation of local intracortical connectivity structure has not been attempted. Recently, it has been shown that it is possible to estimate local coupling of systems governed by integro-difference equations by formulating a state-space model~\cite{Dewar2009}. The key development in this work was to define a state-space model with an order independent of the number of observations (or ECoG recording electrodes in this case). In addition, the appropriate model selection tools have been developed~\cite{Scerri2009} allowing for the application of this technique to neural fields. Modeling the neural dynamics within this framework has a distinct advantage over AR models, such that the number of parameters to define the connectivity basis functions (three in the paper) is considerably smaller than the number of AR coefficients typically required to achieve the relevant information criteria (AIC or BIC). In this paper, we demonstrate for the first time how intracortical connectivity can be inferred from ECoG data, based on a variant of the  Wilson and Cowan neural field model~\cite{Wilson1973}. This work provides a fundamental link between the theoretical advances in neural field modeling and patient specific data.
%Long range connectivity can be estimated using DTI~\cite{Knock2009}, however this short range connectivity can not..

\section{Neural Field Model}
In this section, we describe a variant of the  Wilson and Cowan neural field model~\cite{Wilson1973} that will be used to create our intracortical connectivity estimator. This model is descriptive of a range of neurodynamics of the cortex such as evoked potentials, visual hallucinations, and epileptic behaviour. 
\begin{todo}
	{Really need to add some citations here.}
\end{todo}
It is also capable of generating complex patterns of activity such as Turing patterns, spirals, and traveling oscillations. 
\begin{todo}
	{Same here.}
\end{todo}
The neural field model is popular due to being parsimonious yet having a strong link with the underlying physiology. The model relates the average number of action potentials $g(r,t)$ arriving at position $r$ to the local post synaptic membrane voltage $v(r,t)$. The post-synaptic potentials generated at a neuronal population at location $r$ by action potentials arriving from all other connected populations at locations $r'$ can be described by
\begin{equation}\label{SpikesToPotential}
	v\left( {r,t} \right) = \int_{ - \infty }^t {h\left( {t - t'} \right)g\left( {r,t'} \right)dt'}.
\end{equation}
\begin{todo}
	{Is this equation correct? Is it a convolution in time? Dean: yes}
\end{todo}
The post-synaptic response kernel $h(t)$ is described by
\begin{equation}\label{SynapticRespKernel}
	h(t) = u(t)\exp{\left(-\alpha t\right)}.
\end{equation}
where $\alpha=\tau^{-1}$ and $\tau$ is the synaptic time constant and $u(t)$ is the Heaviside step function. The synaptic response kernel can be more elaborate, using rise and fall time constants, however, this simple form serves our purposes. Nonlocal interactions between cortical populations are described by	
\begin{equation}\label{RateBasedInteractions}
	g\left( r,t \right) = \int_\Omega  {w\left( r,r' \right)f\left( v\left( r',t \right) \right)dr'} + I\left(r,t\right)
\end{equation}

where $f$ is spiking rate of populations $r'$, $w$ is the spatial connectivity kernel, and $\Omega$ is the spatial domain, representing a cortical sheet or surface. The term $I\left(r,t\right)$ accounts for spontaneous activity of the neural populations. The connectivity kernel is a Mexican hat shape described by the sum of weighted Gaussian functions placed at the origin.
\begin{eqnarray}\label{Connectivity Kernel}
	w\left(r,r'\right) =&& \\
&&\theta_1\exp{\left(-\frac{(r-r')^\top(r-r')}{\sigma_1^2}\right)}+\theta_2\exp{\left(-\frac{(r-r')^\top(r-r')}{\sigma_2^2}\right)}+\theta_3\exp{\left(-\frac{(r-r')^\top(r-r')}{\sigma_3^2}\right)}\nonumber
\end{eqnarray}
where $\sigma_i$ is the scale parameter.
% where
% \begin{equation}
% 	\theta=\begin{bmatrix} \theta_{1}\\\theta_{2}\\\theta_{3}\end{bmatrix},\quad 		\Sigma_w=\begin{bmatrix}\Sigma_{w1}\\\Sigma_{w2}\\ \Sigma_{w3}\end{bmatrix}.
% \end{equation}
\begin{todo}
	{Parham ... how are you writing this? DF: I have tried to make it better, but Parham can you check.Parham: I have changed it but I think it's better to include it in the simulation section}
\end{todo}The average firing rate of the presynaptic neurons is related to the postsynaptic membrane potential by the sigmoidal activation function
\begin{equation}\label{ActivationFunction}
	f\left( v\left( r', \bar t \right) \right) = \frac{\nu _0\left(r\right)}{1 + \exp \left( \beta \left( v_0\left( r \right) - v\left(r',t\right) \right) \right)}.
\end{equation}
Even though we will model $v_0$ and $\nu_0$ as being homogeneous across the cortical sheet we will express it as being spatially dependant allowing for generality at this point. By combining Eqs.~\ref{SpikesToPotential} and \ref{RateBasedInteractions} we get the spatiotemporal model
\begin{equation}\label{FullDoubleIntModel}
	v\left(r,t\right) = \int_{-\infty}^t h\left(t - t'\right) \left(\int_\Omega   w\left(r,r'\right) f\left( v\left( r',t \right)\right)dr' + I(r,t) \right)dt'
\end{equation}
% The rearrange the model into an integro-differential we take the Laplace transform of~\ref{FullDoubleIntModel} giving
% \begin{equation}
% 	V(s) = H(s)G(s).
% \end{equation}
% Since $H(s) = (s+\alpha)^{-1}$ we can write
% \begin{equation}
% 	(s+\alpha)V(s) = G(s).
% \end{equation}
To arrive at the final form of the model we shall state the synaptic response kernel as a Green's function
\begin{equation}\label{GreensFuncDef}
	Lh\left( t \right) = \delta \left( t \right),
\end{equation}
where $L=\frac{d}{dt} + \alpha$ is a temporal differential operator and $\delta(t)$ is the Dirac-delta function giving 
\begin{equation}\label{FinalForm1}
	\frac{dv\left( r,t \right)}{dt} + \alpha v\left( r,t \right) = \int_\Omega  {w\left( r,r' \right)f\left( {v\left( r',t \right)} \right)dr'} + I\left(r,t\right).
\end{equation}

\section{Generating Data}
To generate iEEG/LFP data we proceeded with the assumption of spatial homogeneity for the connectivity and activation function parameters, implying $w(r,r') = w\left(|r-r'|\right)$, $\nu_0(r) = \nu_0$ and $v_0(r) = v_0$. In addition we assume the synaptic transmission delay is negligible. The model was discretized in time  (see Appendix~\ref{Time Discretization}) and a stochastic term was added to drive the system and account for uncertainty in the model giving
\begin{equation}\label{DiscreteTimeModel}
	v_{t+1}\left(r\right) = \lambda v_t\left(r\right) + \delta \int_\Omega { w\left(|r-r'|\right) f\left(v_t\left(r'\right)\right) dr'} + \delta I_t\left(r\right) + e_t\left(r\right)
\end{equation}
where $\delta$ is the time step, $\lambda = 1-\alpha\delta$ and $e_t(r) \sim \mathcal{GP}(0,\Sigma)$. The IDE formulation in Eq.~\ref{DiscreteTimeModel} was solved using a numerical method described in Appendix~\ref{Space Discretization}. To generate iEEG/LFP data we used the output function 
\begin{equation}
	y_t(r_n) = \int_{\Omega}{m\left(|r_n-r'|\right)v_t\left(r'\right)dr'} + \varepsilon_t
\end{equation}
where $r_n$ defines the location of the sensors in the field where $n=1,...,N$ indexes the sensors and $\varepsilon_t \sim \mathcal{N}\left(0,\Sigma_y\right)$. The output kernel $m(|r-r'|)$ governs the geometry of pick-up range of sensors where
\begin{equation}
	m\left(|r-r'|\right) = \exp{\left(-\frac{(r-r')^\top(r-r')}{\sigma_m^2}\right)}.
\end{equation}

All the model parameters are described in Table 1.

\begin{tabular}{|c|c|c|}
\hline
Parameter & Value & Reference\\
\hline
$\alpha$ & $100$ s$^{-1}$ &\\
\hline
$\nu_0$ & $1$ s$^{-1}$ &\\
\hline
$v_0$ & $6$ mV &\\
\hline
$\beta$ & $0.56$ spikes/mV$^{-1}$ & \\
\hline
$\delta$ & $1\times10^{-4}$ s &\\
\hline
$\Delta$ & $1$ &\\
\hline
$\theta_1$ &  &\\
\hline
$\theta_2$ &  &\\
\hline
$\theta_3$ &  &\\
\hline
$\sigma_{w1}$ &  &\\
\hline
$\sigma_{w2}$ &  &\\
\hline
$\sigma_{w3}$ &  &\\
\hline
$\sigma_m$ &  &\\
\hline
\end{tabular}

\section{Derivation of Finite Dimensional State-Space Model}
In order to implement standard estimation techniques we use a decomposition of the field using a set of Gaussian basis functions. Decomposition allows a continuous field to be represented by a finite dimensional state vector. This allows for the application of standard nonlinear, non-Gaussian state estimation methods such as the unscented Kalman filter. The field decomposition is described by
\begin{equation}\label{DefFieldDecomp}
	v_t\left(r\right) \approx \phi ^T\left(r\right) x_t
\end{equation}
where $\phi(\mathbf{r})$ is a vector of Gaussian basis functions that are scaled by the state vector, $x_t$. As described in Eq.~\ref{Connectivity Kernel} the connectivity kernel can also be considered a decomposition into a set of basis functions in 
\begin{equation}\label{DefKernelDecomp}
	\tilde{w}( |r-r'| ) = \theta^T\psi\left(|r-r'|\right)
\end{equation}
We will assume we know the parametric form of the connectivity basis functions, where the parameter $\theta$ is unknown. Each connectivity basis function can be considered a layer in the Wilson and Cowan model, representing short range excitation, surround inhibition and mid-range excitation. Making substitutions of~\ref{DefFieldDecomp} and~\ref{DefKernelDecomp} into~\ref{DiscreteTimeModel} we get
\begin{equation}\label{reduced continuous model}
	\phi^T\left( r \right)x_{t+1} = \delta\theta^T\int_\Omega  {\psi \left(|r-r'|\right)f\left( \phi ^T\left(r'\right)x_t \right)dr'}  - \lambda\phi^T\left(r\right)x_t + \delta I_t\left(r\right) + e_t\left(r\right).
\end{equation}
By defining the term
\begin{equation}\label{DefGamma}
	\Gamma  = \int_\Omega  {\phi \left(r\right)\phi ^T\left(r\right)dr}
\end{equation}
and manipulating the model (see Appendix~\ref{Simplifying Decomposition}) we isolate the state vector to form a state-space model
\begin{eqnarray}\label{Homogeneous SS Model}
	x_t &=& q(x_t,\theta,\lambda) + k(I_t) + \tilde{e}_t \\
	q(x_t,\theta,\lambda) &=& \delta\Gamma^{ - 1}\int_\Omega {\phi\left(r\right) \int_\Omega {f\left(\phi^T\left(r'\right)x_t\right)\psi^T \left(|r-r'|\right)dr'} dr} \theta - \lambda x_t \\
	k(I_t) &=& \Gamma^{-1}\delta \int_\Omega{\phi \left(r\right) I_t\left(r\right)dr} \\
	\tilde{e}_t &=& \Gamma^{-1}\int_\Omega{\phi\left(r\right)e_t\left(r\right)dr} \\
\end{eqnarray}
where $\tilde{e}_t \sim \mathcal{N}\left(0,R' \Sigma R\right)$ and $R$ is the Cholesky decomposition of $\Gamma^{-1}$. The observation equation of the reduced model is
\begin{eqnarray}\label{ObservationEquation}
    y_t &=& z\left(x_t\right) + \varepsilon_t \\
	z\left(x_t\right) &=& \int_\Omega m\left(|r_n-r|\right)\phi^T\left(r\right) dr x_t.
\end{eqnarray}

\section{Spectral Analysis and Decomposition}
This section provides


\section{State and Parameter Estimation}
The unscented Kalman filter was used for the state estimation (reference the Julier and Uhlmann paper). This method is appropriate for state estimation of stochastic nonlinear dynamical systems. Alternatives to this approach are the extended Kalman filter (ref?) (EKF) and sequential Monte Carlo (SMC) filtering (ref?). The extended Kalman filter approximates the state transition equation by linearizing about the fixed points (by calculating the Jacobian) at each time step. The linearization maintains the Gaussianality in the model. The unscented Kalman filter approximates the \emph{a posteriori} state density by a Gaussian distribution, whilst maintaining the nonlinearity in the system. This has been shown to give superior performance over the EKF in state estimation, as the EKF maintains a first order approximation where the UKF provides a second order approximation. In addition, the computational requirements of the UKF are smaller than the EKF, since the EKF computes the Jacobian at each time step, where the UKF does not. SMC filtering (particle filtering) can theoretically provide an exact \emph{a posteriori} state density for nonlinear systems. However, this method is not appropriate for our problem, since it is not feasible for high dimensional systems, due to computation demands.

The approximation of the state density is made by propagating the so called sigma points through the state-space model. The sigma points describe the mean and covariance of the state estimate. The accuracy of the approximation is linked to the time step used in the temporal discretization of the system, where the state transition appears more linear with a finer resolution. To explain the operation of the UKF we begin by deriving the traditional Kalman filter with the state-space model
\begin{eqnarray}
	x_t = q(x_t,\theta,\lambda) + k(I_t) + \tilde{e}_t \\
	y_t = z(x_t) + \varepsilon_t,
\end{eqnarray}
where $\theta$ and $\lambda$ are the systems parameters. 

\section{Comparison of Estimated Parameters and True Parameters}

\section{Discussion}

\section{Conclusion}

\appendices

\section{Discrete Time Model}\label{Time Discretization}
To form the IDE neural field model a time discretization must be perform. We used a one-step Euler method where Eq.~\ref{FinalForm1} can be approximated by
\begin{equation}\label{Euler Approximation}	
\frac{v\left( r,t+\delta \right) - v\left( r,t\right)}{\delta} =   -\alpha v\left( r,t \right) + \int_\Omega  {w\left( |r-r'| \right)f\left( {v\left( r',t \right)} \right)dr'} + I\left(r,t\right).
\end{equation}
For clarity, we shall index time points in the discrete time form of the model using the subscript $t$ and the next time point as $t+1$. Rearranging Eq.~\ref{Euler Approximation} we get
\begin{eqnarray}\label{Euler Approximation}	
v_{t+1}\left( r\right) &=& v_t\left( r\right) -\delta \alpha v_t\left( r\right) + \delta \int_\Omega  {w\left( |r-r'| \right)f\left( {v_t\left( r'\right)} \right)dr'} + \delta I_t\left(r\right)
\end{eqnarray}
The discrete time form of the model is
\begin{equation}\label{Discrete Time Model1}
	v_{t+1}\left(r\right) = \lambda v_t\left(r\right) + \delta \int_\Omega { w\left(|r-r'|\right) f\left(v_t\left(r'\right)\right) dr'} + \delta I_t\left(r\right).
\end{equation}
where $\lambda = 1 - \delta \alpha$.

\section{Numerical Solution to IDE Model}\label{Space Discretization}
To solve the intregro-difference equation in Eq.~\ref{Discrete Time Model1} we define the spatial aspect of the model on a regular square $i,j$ grid of neural masses, where the spatial step size $\Delta \mathbf{r}_i = \Delta \mathbf{r}_j = \Delta $ giving
\begin{equation}\label{discrete space}
	v_{t+1}\left(r_{ij}\right) =  \lambda v_t(r_{ij}) + \delta \Delta^2 \sum_{i=1}^{i=I}{\sum_{j=1}^{j=J}{\tilde{w}\left( |r_{ij}-r_{ij}'| \right)f\left( v_t\left( r_{ij}'\right) \right)} } + \delta I_t\left(r\right) + \tilde{e}_t(r_{i,j})
\end{equation}
where $\tilde{e}_t(r_{i,j}) \sim \mathcal{N}\left(0,\Sigma\right)$ and $\tilde{w}(|r_{ij}-r_{ij}'|)$ discretized connectivity kernel described by
\begin{equation}\label{Discrete Connectivity Kernel}
	\tilde{w}(r_{ij},r_{ij}') = \theta^T e^{\frac{\left(\left(r_i'-r_i\right)\Delta\right)^2}{(2\sigma)^2} + \frac{\left(\left(r_j'-r_j\right)\Delta\right)^2}{(2\sigma)^2}}.
\end{equation}
The observation equation and kernel were discretized in the same way by
\begin{equation}\label{Discrete Observation Equation}
    y_k\left(r_{i_n j_n}\right) = \Delta^2\sum_{i=1}^{i=I}\sum_{j=1}^{j=J} \tilde{m}( |r_{i_n j_n}-r_{ij}'| ) v_k\left(r_{ij}'\right)  + \varepsilon_k( r_{i_n j_n})
\end{equation}
where
\begin{equation}\label{Discrete Observation Kernel}
	\tilde{m}(|r_{ij}-r_{ij}'|) = e^{\frac{\left(\left(r_i'-r_i\right)\Delta\right)^2}{(2\sigma)^2} + \frac{\left(\left(r_j'-r_j\right)\Delta\right)^2}{(2\sigma)^2}}.
\end{equation}
We have used periodic boundary conditions to alleviate problems associated with edge effects.

\section{Reduction to Finite State-Space Model}\label{Simplifying Decomposition}
Starting from Eq.~\ref{reduced continuous model} we multiply throughout by $\phi(r)$ and integrate over the spatial domain $\Omega$ to get
\begin{equation}\label{Poo}
	\int_\Omega  {\phi \left(r\right)\phi^T\left(r\right) dr} x_{t+1} = \delta \int_\Omega  {\phi (r) \theta^T \int_\Omega  {\psi \left(|r-r'|\right)f\left(\phi^T\left(r'\right) x_t \right)dr'}dr}  - \lambda\int_\Omega {\phi(r)\phi^T(r)dr} x_t + \delta \int_\Omega{\phi \left(r\right) I_t\left(r\right)dr} + \int_\Omega{\phi \left(r\right) e_t\left(r\right)dr}.
\end{equation}
Substituting Eq.~\ref{DefGamma} into Eq.~\ref{Poo} and cross-multiplying by $\Gamma^{-1}$ gives 
\begin{equation}\label{Homogeneous SS Model}
	x_{t+1} = \delta\Gamma^{ - 1}\int_\Omega {\phi\left(r\right) \int_\Omega {f\left(\phi^T\left(r'\right)x_t\right)\psi^T \left(|r-r'|\right)dr'} dr} \theta - \lambda x_t + \Gamma^{-1}\delta \int_\Omega{\phi \left(r\right) I_t\left(r\right)dr} + \Gamma^{-1}\int_\Omega{\phi\left(r\right)e_t\left(r\right)dr}.
\end{equation}
The disturbance term can be rewritten as 
\begin{equation}
	\Gamma ^{ - 1}\int_\Omega  {\phi \left(r\right)e_t\left(r\right)dr} = \int_\Omega{\phi\left(r\right)\tilde{e}_t\left(r\right)dr},
\end{equation}
where $\tilde{e}_t\left(r\right) \sim \mathcal{N}\left(0,R' \Sigma R\right)$ and $R$ is the Cholesky decomposition of $\Gamma^{-1}$. This provides the final simplified state-space model.
% \section{Ken's Discretization}
% Spatio-temporal interactions can be described by the continuous space continuous time stochastic differential equation
% \begin{equation}\label{differential eq}	
% \tau dv\left( r,t \right) = \left( -v\left( r,t \right) + \int_\Omega  {w\left( r,r' \right)f\left( {v\left( r',t \right)} \right)dr'} \right) dt  + d e\left( r,t \right).
% \end{equation}
% where $e\left( r,t \right)$ is a zero mean temporal Wiener process with incremental covariance $\Sigma_e(r)dt$. (not too sure about this noise since it needs to be white temporally but coloured spatially - which in continuous space-time I have never seen written ... has anyone?)
% To simplify the notation, but without loss of generality, \ref{differential eq} can be rewritten as
% \begin{equation}\label{differential simplified}
% 	dv\left( r,t \right) = q\left(v(r,t) \right) dt  + d e\left( r,t \right)
% \end{equation}
% Had $q\left(v(r,t) \right)$ been a linear function in $v$, then \ref{differential simplified} could be rewritten as
% \begin{equation}\label{differential linear}
% 	dv\left( r,t \right) = Av(r,t)dt  + d e\left( r,t \right)
% \end{equation}
% Considering temporal sampling instances $\delta$ apart given by $\{t_k = 0,~1,~2, \ldots$ \}, then a solution to \ref{differential linear} at each sampling time is given by
% \begin{equation}\label{linear solution}
% 	v(r,t_k+\delta) = \exp\{A(\delta)\}x(t) + \int_{t_k}^{t_k+\delta}\exp\{A(t_k+\delta-\tau)\}de(r,\tau)
% \end{equation}
% Let the discrete time random variable $e'(r,t_k)$ be
% \begin{equation}\label{discrete noise}
% 	e'(r,t_k) = \int_{t_k}^{t_k+\delta}\exp\{A(t_k+\delta-\tau)\}de(r,\tau)
% \end{equation}
% then, $e'(r,t_k)$ is a zero mean, temporally white noise term with covariance
% \begin{equation}\label{covariance of noise}
% 	E\left[e'(r,t_k),e'^\top(r,t_k) \right] = \int_t^{t+\delta}\exp\{A(t_k+\delta-\tau)\} \Sigma_e(r) \exp\{A(t+\delta-\tau)\} d\tau
% \end{equation}
% 
% But we are not so luck as to be able to go from \ref{differential simplified} to \ref{differential linear} and thus I doubt if we can obtain an exact solution to \ref{differential simplified} without an approximation. Agreed?
% 
% A possible approximate solution is the one you have already used. Thus, interpreting the difference equation \ref{differential simplified} as an integral equation gives
% \begin{equation}\label{euler}
% 	v\left(r,t\right) =  v(r,t_0) + \int_{t_0}^{t} q\left(v(r,\tau) \right) d\tau  + \int_{t_0}^{t} d e\left(r,\tau\right)
% \end{equation}
% Using an Euler approximation, \ref{euler} can be approximated at each sampling time by
% \begin{equation}\label{euler approx 1}
% 	v\left(r,t_{k+1} \right) =  v(r,t_k) + q\left(v(r,t_k)\right) (t_{k+1} - t_k) + (e(r,t_{k+1}) - e(r,t_k))
% \end{equation}
% which can be rewritten as
% \begin{equation}\label{euler approx 2}
% 	v\left(r,t_k + \delta \right) =  v(r,t_k) + \delta q\left(v(r,t_k)\right) + e'(r,t_k)
% \end{equation}
% where $e'(r,t_k)$ is a zero mean Gaussian random variable with covariance $\delta\Sigma_e$. (Note that, because of the way the noise is defined in \ref{differential eq} it is not $\delta^2$ but $\delta$)

% you can choose not to have a title for an appendix
% if you want by leaving the argument blank
\section{Colored noise}
We have
\begin{equation}
v_{t + 1}\left( \mathbf{r} \right)  = T_s\int_\Omega  {k\left( {{\bf{r}} , {\bf{r'}}} \right)f\left( {{v_t}\left( \bf{r'} \right)} \right)d{\bf{r'}}} + \lambda v_t\left( {\bf{r}} \right) + T_se_t\left( {\mathbf{r}} \right).
\end{equation}
where the disturbance $e_t(\mathbf r)$ is a zero-mean normally distributed noise process, spatially coloured but temporally white, with covariance 

\begin{equation}
cov(e_t(\mathbf{s}),e_{t+\tau}(\mathbf{r}))=
\begin{cases}
\beta\left(\mathbf{s}-\mathbf{r}\right), & \tau=0 \\
0 & \mathrm{otherwise}
\end{cases}
\label{eq:FieldCovariance}
\end{equation}
The final state-space model is given by
\begin{equation}
x_{t + 1} = T_sq(x_t)\theta -\lambda x_t + T_s\Gamma^{-1}\int_\Omega  {\phi ( \mathbf{r} )e_t( \mathbf{r} )d\mathbf{r}}
\end{equation}
then the covariance of the noise term is given by
\begin{eqnarray}
\mathbf \Sigma_w&{}={}&T_s^2 \times \mathbf{\Gamma}^{-1}\mathbf E[\int_{\mathcal{S}}\boldsymbol\phi\left(\mathbf s\right)e_t\left(\mathbf s\right)d\mathbf s\int_{\mathcal{S}}\boldsymbol\phi\left(\mathbf r\right)^{\top}e_t\left(\mathbf r\right)d\mathbf r]\mathbf{\Gamma}_{x}^{- \top} \nonumber \\
&=&T_s^2 \times\mathbf{\Gamma}^{-1}\iint\limits_{\mathcal{S}}\boldsymbol\phi\left(\mathbf s\right) \mathbf E[e_t\left(\mathbf s\right)e_t\left(\mathbf r\right)]\boldsymbol\phi\left(\mathbf r\right)^{\top}d\mathbf r d\mathbf s\mathbf{\Gamma}^{- \top} \nonumber\\
&=&{}T_s^2 \times\mathbf{\Gamma}^{-1}\iint\limits_{\mathcal{S}}\boldsymbol\phi\left(\mathbf s\right) \beta\left(\mathbf s- \mathbf r \right)\boldsymbol\phi\left(\mathbf r\right)^{\top}d\mathbf r d\mathbf s\mathbf{\Gamma}^{- \top} 
\end{eqnarray}

\section{Parameter estimation using LS}
\begin{equation}
 \mathbf x_{t+1}=\mathbf x_{t}+T_s \mathbf Q(\mathbf x_t)\mathbf \theta-\alpha T_s\mathbf x_t+T_s\boldsymbol\Gamma^{-1}\int_\Omega\boldsymbol\phi(\mathbf r)\varepsilon_t(\mathbf r)d\mathbf r
\label{eq:statespacemodel}
\end{equation}
where the matrix $\mathbf Q_{n_x \times n_{\theta}}(\mathbf x_t)$ is defined as
\begin{equation}
 Q_{n_x \times n_{\theta}}=\boldsymbol\Gamma^{-1}\int_\Omega\boldsymbol\phi(\mathbf r)\int_\Omega f(\boldsymbol\phi^\top(\mathbf r')\mathbf x_t)\boldsymbol\psi^\top(\mathbf r-\mathbf r')d\mathbf r'd\mathbf r
\end{equation}
and $T_s$ is the sampling period. Least Square method can be used as (\ref{eq:statespacemodel}) is linear in parameters. At each time instant we have

\begin{eqnarray}
 \mathbf x_{1}&=&\mathbf x_{0}+T_s \mathbf Q(\mathbf x_0)\mathbf \theta-\alpha T_s\mathbf x_0+T_s\mathbf e_0 \nonumber \\
 \mathbf x_{2}&=&\mathbf x_{1}+T_s \mathbf Q(\mathbf x_1)\mathbf \theta-\alpha T_s\mathbf x_1+T_s\mathbf e_1\nonumber\\
&\vdots& \nonumber\\
 \mathbf x_{n}&=&\mathbf x_{n-1}+T_s \mathbf Q(\mathbf x_{n-1})\mathbf \theta-\alpha T_s\mathbf x_{n-1}+T_s\mathbf e_{n-1}
\end{eqnarray}
in matrix form
\begin{equation}
 \begin{bmatrix} \mathbf x_{1}\\\mathbf x_{2}\\\vdots\\\mathbf x_{n}\end{bmatrix}-\begin{bmatrix} \mathbf x_{0}\\\mathbf x_{1}\\\vdots\\\mathbf x_{n-1}\end{bmatrix}=T_s\begin{bmatrix}\mathbf Q(\mathbf x_0)&-\mathbf x_{0}\\\mathbf Q(\mathbf x_1)&-\mathbf x_{1}\\\vdots\\ \mathbf Q(\mathbf x_{n-1})&-\mathbf x_{n-1}\end{bmatrix}\begin{bmatrix}\mathbf \theta \\ \alpha\end{bmatrix}+T_s\begin{bmatrix}\mathbf e_0\\\mathbf e_1\\\vdots\\\mathbf e_{n-1}\end{bmatrix}
\end{equation}
or in compact form we have
\begin{equation}
 \mathbf Z=\mathbf X \mathbf W+\boldsymbol \xi
\end{equation}
where
\begin{equation}
 \mathbf Z=\begin{bmatrix} \mathbf x_{1}-\mathbf x_{0}\\\mathbf x_{2}-\mathbf x_{1}\\\vdots\\\mathbf x_{n}-\mathbf x_{n-1}\end{bmatrix},\quad \mathbf X=T_s\begin{bmatrix}\mathbf Q(\mathbf x_0)&-\mathbf x_{0}\\\mathbf Q(\mathbf x_1)&-\mathbf x_{1}\\\vdots\\ \mathbf Q(\mathbf x_{n-1})&-\mathbf x_{n-1}\end{bmatrix},\quad \mathbf W=\begin{bmatrix}\mathbf \theta \\ \alpha\end{bmatrix} \text{and}\quad \boldsymbol \xi=T_s\begin{bmatrix}\mathbf e_0\\\mathbf e_1\\\vdots\\\mathbf e_{n-1}\end{bmatrix}
\end{equation}
using the method of Least Square $ \mathbf W$ can be estimated
\begin{equation}
 \mathbf W\approx(\mathbf X^\top\mathbf X)^{-1}\mathbf X^\top\mathbf Z
\end{equation}
% use section* for acknowledgement
\section{clarification for the derivation} 
I ignore noise here. From equation (\ref{SpikesToPotential}) we can say $h$ is the foundamental solution to the equation
\begin{equation}
 Lv(r,t)=g(r,t)
\label{eq:LV}
\end{equation}
where $L$ is a temporal differential operator, since $h(t)$ is the foundamental solution to (\ref{eq:LV}) it can be written as a Green's function
\begin{equation}
 Lh(t)=\delta(t)
\end{equation}
where $L=1+\tau\frac{d}{dt}$ therefore equation (\ref{eq:LV}) becomes:
\begin{equation}
\tau\frac{dv(r,t)}{dt}+ v(r,t)=g(r,t)
\end{equation}
substituting (\ref{RateBasedInteractions}) for $g(r,t)$ gives
\begin{equation}
\frac{dv\left( {r,t} \right)}{dt} + \frac{1}{\tau} v\left( r,t \right) = \frac{1}{\tau}\int_\Omega  {w\left( r,r' \right)f\left( {v\left( r',\bar t \right)} \right)dr'} 
\end{equation}



\section*{Acknowledgment}
The authors would like to thank...

\ifCLASSOPTIONcaptionsoff
  \newpage
\fi



% references section

\bibliographystyle{IEEEtran}
\bibliography{IEEEabrv,BrainIDE}


% biography section
%
% If you have an EPS/PDF photo (graphicx package needed) extra braces are
% needed around the contents of the optional argument to biography to prevent
% the LaTeX parser from getting confused when it sees the complicated
% \includegraphics command within an optional argument. (You could create
% your own custom macro containing the \includegraphics command to make things
% simpler here.)
%\begin{biography}[{\includegraphics[width=1in,height=1.25in,clip,keepaspectratio]{mshell}}]{Michael Shell}
% or if you just want to reserve a space for a photo:

\begin{IEEEbiography}{Dean R. Freestone}
Biography text here.
\end{IEEEbiography}

% if you will not have a photo at all:
\begin{IEEEbiography}{Parham Aram}
Biography text here.
\end{IEEEbiography}

% insert where needed to balance the two columns on the last page with
% biographies
%\newpage

\begin{IEEEbiography}{Michael Dewar}
Biography text here.
\end{IEEEbiography}

\begin{IEEEbiography}{Kenneth Scerri}
Biography text here.
\end{IEEEbiography}

\begin{IEEEbiography}{Visakan Kadirkamanathani}
Biography text here.
\end{IEEEbiography}

\begin{IEEEbiography}{Other Bosses}
Biography text here.
\end{IEEEbiography}

% that's all folks
\end{document} 